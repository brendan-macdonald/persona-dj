// PostgreSQL datasource and Prisma client generator
// Note: For production deployment on Vercel, PostgreSQL is required (SQLite won't work in serverless)
datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

generator client {
	provider = "prisma-client-js"
}

// User model
model User {
	id         String     @id @default(cuid())
	providerId String?    @unique
	createdAt  DateTime   @default(now())
	vibes      Vibe[]
	playlists  Playlist[]
}

// Vibe model
model Vibe {
	id            String     @id @default(cuid())
	userId        String?
	user          User?      @relation(fields: [userId], references: [id])
	inputText     String
	normalizedKey String
	specJson      Json
	tracks        Json
	createdAt     DateTime   @default(now())
	playlists     Playlist[]
}

model Playlist {
	id          String   @id @default(cuid())
	userId      String
	user        User     @relation(fields: [userId], references: [id])
	vibeId      String?
	vibe        Vibe?    @relation(fields: [vibeId], references: [id])
	spotifyId   String   @unique
	spotifyUrl  String
	name        String
	trackCount  Int
	createdAt   DateTime @default(now())
}

// Metric model
model Metric {
	id        String   @id @default(cuid())
	kind      String
	value     Float
	meta      Json?
	createdAt DateTime @default(now())
}

// Session model
model Session {
	id        String   @id @default(cuid())
	userId    String?
	createdAt DateTime @default(now())
}
